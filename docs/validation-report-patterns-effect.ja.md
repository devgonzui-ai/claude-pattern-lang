# ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨åŠ¹æœã®æ¤œè¨¼ãƒ¬ãƒãƒ¼ãƒˆ

**æ¤œè¨¼æ—¥**: 2026-01-31
**æ¤œè¨¼è€…**: Claude Code + ãƒ¦ãƒ¼ã‚¶ãƒ¼

## æ¤œè¨¼ç›®çš„

`cpl sync`ã§CLAUDE.mdã«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã§ã€Claude Codeã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåŠ¹ç‡ãŒæ”¹å–„ã•ã‚Œã‚‹ã‹æ¤œè¨¼ã™ã‚‹ã€‚

## æ¤œè¨¼æ–¹æ³•

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
2ã¤ã®åŒä¸€æ§‹æˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆï¼š

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | CLAUDE.md | ãƒ‘ã‚¿ãƒ¼ãƒ³æ•° |
|------------|-----------|-----------|
| `cpl-test-without-patterns` | ãªã— | 0 |
| `cpl-test-with-patterns` | ã‚ã‚Š | 5 |

### é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
1. Read-Before-EditåŸå‰‡
2. ESMã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹è§£æ±º
3. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼æ®µéšçš„èª¿æŸ»
4. **å‹å®‰å…¨ãªéåŒæœŸAPIé–¢æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** â† æ¤œè¨¼ã‚¿ã‚¹ã‚¯ã«é–¢é€£
5. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°å…ˆè¡Œç¢ºèª

### æ¤œè¨¼ã‚¿ã‚¹ã‚¯
ä¸¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§åŒä¸€ã®ã‚¿ã‚¹ã‚¯ã‚’ä¾é ¼ï¼š
> ã€ŒAPIå‘¼ã³å‡ºã—é–¢æ•°ã‚’ä½œã£ã¦ã€

## æ¤œè¨¼çµæœ

### ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡

| æŒ‡æ¨™ | ãƒ‘ã‚¿ãƒ¼ãƒ³ãªã— | ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚Š | å·®åˆ† |
|------|-------------|-------------|------|
| Messages (ã‚¿ãƒ¼ãƒ³æ•°) | 14 | 9 | **-35.7%** |
| Input Tokens | 118 | 848 | +619% |
| Output Tokens | 50 | 29 | -42% |
| Cache Creation | 54,546 | 68,651 | +25.9% |
| Cache Read | 326,732 | 176,135 | -46.1% |
| Cache Efficiency | 85.7% | 72.0% | -13.7pt |

### ç”Ÿæˆã‚³ãƒ¼ãƒ‰

| æŒ‡æ¨™ | ãƒ‘ã‚¿ãƒ¼ãƒ³ãªã— | ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚Š |
|------|-------------|-------------|
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º | 1,746 bytes | 907 bytes |
| è¡Œæ•° | 69è¡Œ | 39è¡Œ |
| æ§‹é€  | ç‹¬è‡ªè¨­è¨ˆï¼ˆæ±ç”¨apié–¢æ•°+ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼‰ | ãƒ‘ã‚¿ãƒ¼ãƒ³æº–æ‹ ï¼ˆfetchData<T>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ |

#### ãƒ‘ã‚¿ãƒ¼ãƒ³ãªã—ï¼ˆ69è¡Œï¼‰
```typescript
// ç‹¬è‡ªã®å‹å®šç¾©
type HttpMethod = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';
interface RequestOptions { ... }
interface ApiError extends Error { ... }

// æ±ç”¨é–¢æ•° + ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
async function api<T>(...): Promise<T> { ... }
export const get = <T>(...) => api<T>('GET', ...);
export const post = <T>(...) => api<T>('POST', ...);
// ... ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚‚
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚Šï¼ˆ39è¡Œï¼‰
```typescript
// ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å¿ å®Ÿã«å†ç¾
export async function fetchData<T>(endpoint: string): Promise<T> {
  try {
    const response = await fetch(endpoint);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return await response.json();
  } catch (error) {
    console.error('API request failed:', error);
    throw error;
  }
}
```

## è€ƒå¯Ÿ

### å½“åˆã®ä»®èª¬ï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåœ§ç¸®ï¼‰

**çµæœ: é”æˆã•ã‚Œãš**

- Cache Efficiencyã¯ä½ä¸‹ï¼ˆ85.7% â†’ 72.0%ï¼‰
- CLAUDE.mdã«ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆç´„3KBï¼‰ãŒè¿½åŠ ã•ã‚ŒãŸã“ã¨ã§ã€åˆæœŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå¢—åŠ 
- æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ãã«ãã„

### ç™ºè¦‹ã•ã‚ŒãŸåŠ¹æœ

#### 1. ã‚¿ã‚¹ã‚¯å®Œäº†åŠ¹ç‡ã®å‘ä¸Š
- **ã‚¿ãƒ¼ãƒ³æ•°35%å‰Šæ¸›**ï¼ˆ14 â†’ 9ã‚¿ãƒ¼ãƒ³ï¼‰
- ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã€Œæ­£è§£ã¸ã®æœ€çŸ­ãƒ«ãƒ¼ãƒˆã€ã¨ã—ã¦æ©Ÿèƒ½
- AIã®è©¦è¡ŒéŒ¯èª¤ãƒ»ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹ãŒæ¸›å°‘

#### 2. ã‚³ãƒ¼ãƒ‰å“è³ªã®ä¸€è²«æ€§
- **ã‚³ãƒ¼ãƒ‰é‡44%å‰Šæ¸›**ï¼ˆ69è¡Œ â†’ 39è¡Œï¼‰
- ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æ²¿ã£ãŸäºˆæ¸¬å¯èƒ½ãªå®Ÿè£…
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€

#### 3. æš—é»™çŸ¥ã®å½¢å¼åŒ–
- ãƒãƒ¼ãƒ ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦è“„ç©
- AIãŒã€Œã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã“ã†ã™ã‚‹ã€ã‚’å³åº§ã«ç†è§£

## çµè«–

| è¦³ç‚¹ | è©•ä¾¡ | ã‚³ãƒ¡ãƒ³ãƒˆ |
|------|------|---------|
| ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåœ§ç¸® | âŒ | CLAUDE.mdã‚µã‚¤ã‚ºå¢—åŠ ã«ã‚ˆã‚Šã‚€ã—ã‚å¢—åŠ  |
| ã‚¿ã‚¹ã‚¯å®Œäº†é€Ÿåº¦ | âœ… | ã‚¿ãƒ¼ãƒ³æ•°35%æ¸›ã§åŠ¹ç‡åŒ– |
| ã‚³ãƒ¼ãƒ‰å“è³ª | âœ… | ä¸€è²«æ€§ã®ã‚ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£… |
| é–‹ç™ºè€…ä½“é¨“ | âœ… | è¿·ã„ãªãå®Ÿè£…ãŒå®Œäº† |

**ç·è©•**:
ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨ã®ä¸»ãªåŠ¹æœã¯ã€Œãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ã€ã§ã¯ãªãã€Œ**ã‚¿ã‚¹ã‚¯å®Œäº†åŠ¹ç‡ã¨ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š**ã€ã«ã‚ã‚‹ã€‚ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯AIã¸ã®æ˜ç¢ºãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã¨ã—ã¦æ©Ÿèƒ½ã—ã€çµæœçš„ã«å°‘ãªã„ã‚„ã‚Šå–ã‚Šã§ç›®çš„ã‚’é”æˆã§ãã‚‹ã€‚

## ä»Šå¾Œã®æ¤œè¨äº‹é …

1. **ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç²’åº¦æœ€é©åŒ–**: å¿…è¦æœ€å°é™ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«çµã‚‹ã“ã¨ã§CLAUDE.mdã‚µã‚¤ã‚ºã‚’æŠ‘åˆ¶
2. **é•·æœŸã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã®åŠ¹æœæ¸¬å®š**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã„ãŸçŠ¶æ…‹ã§ã®æ¯”è¼ƒ
3. **ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—åˆ¥ã®åŠ¹æœåˆ†æ**: ã©ã®ç¨®é¡ã®ã‚¿ã‚¹ã‚¯ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæœ€ã‚‚åŠ¹æœçš„ã‹

## ä»˜éŒ²: åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```javascript
// /tmp/analyze-tokens.js
const fs = require('fs');
const readline = require('readline');

async function analyzeSession(filePath) {
  const fileStream = fs.createReadStream(filePath);
  const rl = readline.createInterface({ input: fileStream, crlfDelay: Infinity });

  let totalInput = 0, totalOutput = 0, totalCacheCreation = 0, totalCacheRead = 0, messageCount = 0;

  for await (const line of rl) {
    try {
      const obj = JSON.parse(line);
      if (obj.message && obj.message.usage) {
        const u = obj.message.usage;
        totalInput += u.input_tokens || 0;
        totalOutput += u.output_tokens || 0;
        totalCacheCreation += u.cache_creation_input_tokens || 0;
        totalCacheRead += u.cache_read_input_tokens || 0;
        messageCount++;
      }
    } catch (e) {}
  }

  console.log('\nğŸ“Š Session Token Analysis');
  console.log('Messages:        ' + messageCount);
  console.log('Input Tokens:    ' + totalInput);
  console.log('Output Tokens:   ' + totalOutput);
  console.log('Cache Creation:  ' + totalCacheCreation);
  console.log('Cache Read:      ' + totalCacheRead);
}
```
